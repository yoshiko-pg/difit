
  describe('Generated file detection', () => {
    it('detects lock files as generated', () => {
      const lockFiles = [
        'package-lock.json',
        'yarn.lock',
        'pnpm-lock.yaml',
        'Cargo.lock',
        'Gemfile.lock',
        'poetry.lock',
        'composer.lock',
        'Pipfile.lock',
        'go.sum',
        'pubspec.lock',
        'flake.lock',
      ];

      for (const file of lockFiles) {
        const diffLines = [
          `diff --git a/${file} b/${file}`,
          `index abc123..def456 100644`,
          `--- a/${file}`,
          `+++ b/${file}`,
          `@@ -1 +1 @@`,
          `-old`,
          `+new`,
        ];

        const summary = {
          file,
          insertions: 1,
          deletions: 1,
          binary: false,
        };

        const result = (parser as any).parseFileBlock(diffLines.join('\n'), summary);
        expect(result.isGenerated).toBe(true);
      }
    });

    it('detects minified files as generated', () => {
      const minFiles = ['script.min.js', 'style.min.css', 'vendor/lib.min.js'];

      for (const file of minFiles) {
        const diffLines = [
          `diff --git a/${file} b/${file}`,
          `index abc123..def456 100644`,
          `--- a/${file}`,
          `+++ b/${file}`,
          `@@ -1 +1 @@`,
          `-old`,
          `+new`,
        ];

        const summary = {
          file,
          insertions: 1,
          deletions: 1,
          binary: false,
        };

        const result = (parser as any).parseFileBlock(diffLines.join('\n'), summary);
        expect(result.isGenerated).toBe(true);
      }
    });

    it('detects source maps as generated', () => {
      const file = 'main.js.map';
      const diffLines = [
        `diff --git a/${file} b/${file}`,
        `index abc123..def456 100644`,
        `--- a/${file}`,
        `+++ b/${file}`,
        `@@ -1 +1 @@`,
        `-old`,
        `+new`,
      ];

      const summary = {
        file,
        insertions: 1,
        deletions: 1,
        binary: false,
      };

      const result = (parser as any).parseFileBlock(diffLines.join('\n'), summary);
      expect(result.isGenerated).toBe(true);
    });

    it('does not mark normal files as generated', () => {
      const normalFiles = ['script.js', 'style.css', 'README.md', 'package.json'];

      for (const file of normalFiles) {
        const diffLines = [
          `diff --git a/${file} b/${file}`,
          `index abc123..def456 100644`,
          `--- a/${file}`,
          `+++ b/${file}`,
          `@@ -1 +1 @@`,
          `-old`,
          `+new`,
        ];

        const summary = {
          file,
          insertions: 1,
          deletions: 1,
          binary: false,
        };

        const result = (parser as any).parseFileBlock(diffLines.join('\n'), summary);
        expect(result.isGenerated).toBe(false);
      }
    });

    it('detects binary lock files as generated', () => {
      // Some lock files might be treated as binary in some contexts or if they contain nulls
      const file = 'yarn.lock';
      const diffLines = [
        `diff --git a/${file} b/${file}`,
        `index abc123..def456 100644`,
        `--- a/${file}`,
        `+++ b/${file}`,
        `Binary files a/${file} and b/${file} differ`,
      ];

      const summary = {
        file,
        insertions: 0,
        deletions: 0,
        binary: true,
      };

      const result = (parser as any).parseFileBlock(diffLines.join('\n'), summary);
      expect(result.isGenerated).toBe(true);
    });
  });
